// VS Code tasks configuration. Markdownlint tasks removed per policy (use npx --yes manually).
{
  "$schema": "vscode://schemas/tasks",
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Checks: linters (all)",
      "type": "shell",
      "command": "pwsh",
      "args": [
  "-NoProfile",
  "-Command",
  "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; Set-Location $root; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; } & $python -m ruff check .; $ruffExit = $LASTEXITCODE; & $python -m black --check .; $blackExit = $LASTEXITCODE; if ($ruffExit -ne 0 -or $blackExit -ne 0) { exit 1 } }"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Checks: types (pyright+mypy)",
      "type": "shell",
      "command": "pwsh",
      "args": [
  "-NoProfile",
  "-Command",
  "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $agent = Join-Path $root \"novapolis_agent\"; Set-Location $agent; $pyright = Join-Path $root \".venv\\Scripts\\pyright.exe\"; if (-not (Test-Path -LiteralPath $pyright)) { $pyright = \"pyright\"; } & $pyright -p pyrightconfig.json; if ($LASTEXITCODE -ne 0) { exit $LASTEXITCODE }; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; } & $python -m mypy --config-file mypy.ini app scripts; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Tests: coverage (fail-under)",
      "type": "shell",
      "command": "pwsh",
      "args": [
  "-NoProfile",
  "-Command",
  "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; } $cover = Join-Path $root \"novapolis_agent\"; $cover = Join-Path $cover \".coveragerc\"; & $python -m pytest -q --cov --cov-report=term-missing --cov-branch --cov-config $cover --cov-fail-under=80; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Checks: full",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "Write-Host 'Checks: full completed.'"],
      "options": { "cwd": "${workspaceFolder}" },
      "dependsOn": [
        "Checks: linters (all)",
        "Checks: types (pyright+mypy)",
        "Tests: coverage (fail-under)"
      ],
      "dependsOrder": "sequence",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Git: commit+push",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-File", "${workspaceFolder}/scripts/git_commit_push.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: full",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "tree /A /F | Out-File -Encoding ascii workspace_tree_full.txt"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: directories",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "tree /A | Out-File -Encoding ascii workspace_tree.txt"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: summary (dirs)",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-File", "${workspaceFolder}/scripts/update_workspace_tree_dirs.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    }
  ]
}