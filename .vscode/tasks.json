// VS Code tasks configuration. Markdownlint tasks removed per policy (use npx --yes manually).
{
  "$schema": "vscode://schemas/tasks",
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Checks: linters (all)",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile","-File","${workspaceFolder}/scripts/checks_linters.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "lint:ruff",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = 'Stop'; $root = '${workspaceFolder}'; Set-Location $root; $python = Join-Path $root '.venv\\Scripts\\python.exe'; if (-not (Test-Path -LiteralPath $python)) { $python = 'python'; }; & $python -m ruff check .; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "format:black",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = 'Stop'; $root = '${workspaceFolder}'; Set-Location $root; $python = Join-Path $root '.venv\\Scripts\\python.exe'; if (-not (Test-Path -LiteralPath $python)) { $python = 'python'; }; & $python -m black .; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "fix:ruff",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = 'Stop'; $root = '${workspaceFolder}'; Set-Location $root; $python = Join-Path $root '.venv\\Scripts\\python.exe'; if (-not (Test-Path -LiteralPath $python)) { $python = 'python'; }; & $python -m ruff check --fix .; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Tests: pytest (-q) [root]",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile","-File","${workspaceFolder}/scripts/tests_pytest_root.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Checks: types (pyright+mypy)",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile","-File","${workspaceFolder}/scripts/checks_types.ps1"],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Tests: coverage (fail-under)",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-File", "${workspaceFolder}/scripts/run_pytest_coverage.ps1"],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Checks: full",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "Write-Host 'Checks: full completed.'"],
      "options": { "cwd": "${workspaceFolder}" },
      "dependsOn": [
        "Checks: linters (all)",
        "Checks: types (pyright+mypy)",
        "Tests: coverage (fail-under)"
      ],
      "dependsOrder": "sequence",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    },
    {
      "label": "Git: commit+push",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-File", "${workspaceFolder}/scripts/git_commit_push.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: full",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "tree /A /F | Out-File -Encoding ascii workspace_tree_full.txt"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: directories",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-Command", "tree /A | Out-File -Encoding ascii workspace_tree.txt"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    },
    {
      "label": "Workspace tree: summary (dirs)",
      "type": "shell",
      "command": "pwsh",
      "args": ["-NoProfile", "-File", "${workspaceFolder}/scripts/update_workspace_tree_dirs.ps1"],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    }
    ,
    {
      "label": "Tests: pytest (-q)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; }; & $python -m pytest -q; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    }
    ,
    {
      "label": "Docs: DONELOG append",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $path = Join-Path $root \"novapolis_agent\\docs\\DONELOG.txt\"; $ts = Get-Date -Format 'yyyy-MM-dd HH:mm'; $author = \"${input:doneAuthor}\"; if ([string]::IsNullOrWhiteSpace($author)) { $author = $env:USERNAME }; $msg = \"${input:doneMessage}\"; if ([string]::IsNullOrWhiteSpace($msg)) { Write-Error 'DONELOG message is required.'; exit 1 }; $line = \"$ts | $author | $msg\"; Add-Content -LiteralPath $path -Encoding UTF8 $line }"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "group": "build",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 }
    }
    ,
    {
      "label": "Tests: pytest (unit)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; }; & $python -m pytest -q -m 'unit'; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    }
    ,
    {
      "label": "Tests: pytest (api+streaming)",
      "type": "shell",
      "command": "pwsh",
      "args": [
        "-NoProfile",
        "-Command",
        "& { $ErrorActionPreference = \"Stop\"; $root = \"${workspaceFolder}\"; $python = Join-Path $root \".venv\\Scripts\\python.exe\"; if (-not (Test-Path -LiteralPath $python)) { $python = \"python\"; }; & $python -m pytest -q -m 'api or streaming'; exit $LASTEXITCODE }"
      ],
      "options": { "cwd": "${workspaceFolder}/novapolis_agent" },
      "group": "test",
      "presentation": { "reveal": "always", "panel": "dedicated", "clear": false, "group": "dedicated-all" },
      "runOptions": { "instanceLimit": 1 },
      "problemMatcher": []
    }
  ]
  ,
  "inputs": [
    {
      "id": "doneMessage",
      "type": "promptString",
      "description": "Kurzbeschreibung für DONELOG (z.B. 'Tests/Typen grün; Docs aktualisiert').",
      "default": ""
    },
    {
      "id": "doneAuthor",
      "type": "promptString",
      "description": "Autor (leer = Windows-Benutzername)",
      "default": ""
    }
  ]
}